# Requirements Traceability Matrix – SB Sommar

Generated by auditing the codebase against all requirements documents.
Audit date: 2026-02-23.

Sources read: `02-REQUIREMENTS.md`, `05-DATA_CONTRACT.md`, `07-DESIGN.md`, `CLAUDE.md`,
`app.js`, all files under `source/api/`, `source/build/`, `source/assets/js/client/`,
`source/assets/cs/style.css`, and all files under `tests/`.

---

## Traceability Table

| ID | Requirement | Doc ref | Implemented in | Test(s) | Status |
|----|-------------|---------|----------------|---------|--------|
| REQ-02-01 | Homepage exists and is served at `/` | 02-REQUIREMENTS.md §2 | `source/build/render-index.js`, `source/build/build.js` | — | implemented |
| REQ-02-02 | Weekly schedule page exists at `/schema.html` | 02-REQUIREMENTS.md §2 | `source/build/render.js`, `source/build/build.js` | `tests/snapshot.test.js` – `renderSchedulePage produces valid HTML structure` | covered |
| REQ-02-03 | Daily view at `/dagens-schema.html` allows navigation between days | 02-REQUIREMENTS.md §2, §4 | — (page exists but shows today only; no day navigation) | — | gap |
| REQ-02-04 | Today/Display view at `/idag.html` uses dark background and no navigation | 02-REQUIREMENTS.md §2, §4 | — (`idag.html` has standard nav and light theme; dark/no-nav view is at `dagens-schema.html`) | — | gap |
| REQ-02-05 | Add-activity page exists at `/lagg-till.html` | 02-REQUIREMENTS.md §2 | `source/build/render-add.js`, `source/build/build.js` | — | implemented |
| REQ-02-06 | Archive page exists at `/arkiv.html` | 02-REQUIREMENTS.md §2, §16 | — | — | gap |
| REQ-02-07 | RSS feed exists at `/schema.rss` | 02-REQUIREMENTS.md §2, §15 | — | — | gap |
| REQ-02-08 | Homepage, schedule, add-activity, and archive pages share header and navigation | 02-REQUIREMENTS.md §2 | `source/build/layout.js` – `pageNav()` | — | implemented |
| REQ-02-09 | Today/Display view has no header or navigation | 02-REQUIREMENTS.md §2, §4 | `source/build/render-today.js` – no `pageNav()` call | — | implemented |
| REQ-02-10 | Homepage answers pre-camp questions (who, when, where, cost, registration, rules, testimonials) | 02-REQUIREMENTS.md §3 | `source/build/render-index.js`, `source/content/` Markdown sections | — | implemented |
| REQ-02-11 | Homepage includes a FAQ section | 02-REQUIREMENTS.md §3 | `source/build/render-index.js` – collapsible accordion mode; `tests/render-index.test.js` – `convertMarkdown – collapsible` | `tests/render-index.test.js` – collapsible mode suite | covered |
| REQ-02-12 | Homepage remains complete even when no camp is active | 02-REQUIREMENTS.md §3 | `source/build/build.js` – falls back to most recent camp when no `active: true` | — | implemented |
| REQ-02-13 | Schedule and add-activity links are prominent when a camp is active or upcoming | 02-REQUIREMENTS.md §3 | `source/build/layout.js` – nav always shows all links (not conditionally prominent) | — | implemented |
| REQ-02-14 | Weekly schedule shows all activities for the full camp week | 02-REQUIREMENTS.md §4 | `source/build/render.js` – `renderSchedulePage()` | `tests/snapshot.test.js` – `renders all events` | covered |
| REQ-02-15 | Activities within each day are listed in chronological order | 02-REQUIREMENTS.md §4, §11 | `source/build/render.js` – `groupAndSortEvents()` | `tests/render.test.js` – `sorts events within a day by start time` | covered |
| REQ-02-16 | Each activity shows title, start time, end time (if set), location, and responsible person | 02-REQUIREMENTS.md §4 | `source/build/render.js` – `renderEventRow()` | `tests/render.test.js` – `renderEventRow` suite | covered |
| REQ-02-17 | Daily view allows navigation between days | 02-REQUIREMENTS.md §4 | — | — | gap |
| REQ-02-18 | Today view shows only today's activities | 02-REQUIREMENTS.md §4 | `source/assets/js/client/events-today.js` – filters by `today` date | — | implemented |
| REQ-02-19 | Today/Display view is legible at distance: dark background, large text, minimal chrome | 02-REQUIREMENTS.md §4 | `source/build/render-today.js` – `class="display-mode"` on body; `source/assets/cs/style.css` | — | implemented |
| REQ-02-20 | Today/Display view requires no interaction; it shows today with no day navigation | 02-REQUIREMENTS.md §4 | `source/build/render-today.js` – no day controls | — | implemented |
| REQ-02-21 | Clicking an activity opens its detail view | 02-REQUIREMENTS.md §4, §5 | `source/build/render.js` – `renderEventRow()` uses `<details>` element | `tests/render.test.js` – `renders a <details> row when description is present` | covered |
| REQ-02-22 | Activity detail shows all populated fields; fields with no value do not appear | 02-REQUIREMENTS.md §5 | `source/build/render.js` – `eventExtraHtml()`, `renderEventRow()` | `tests/render.test.js` – `eventExtraHtml` suite | covered |
| REQ-02-23 | Form at `/lagg-till.html` allows submitting a new activity | 02-REQUIREMENTS.md §6 | `source/build/render-add.js`, `source/assets/js/client/lagg-till.js` | — | implemented |
| REQ-02-24 | Date field is constrained to the active camp's date range | 02-REQUIREMENTS.md §6 | `source/build/render-add.js` – `min` / `max` attributes on date input | — | implemented |
| REQ-02-25 | Location field is a dropdown populated from `source/data/local.yaml` | 02-REQUIREMENTS.md §6, §8 | `source/build/build.js` – loads `local.yaml`; `source/build/render-add.js` – renders `<select>` | — | implemented |
| REQ-02-26 | Time fields guide the user toward a valid `HH:MM` value | 02-REQUIREMENTS.md §6 | `source/build/render-add.js` – `type="time"` inputs | — | implemented |
| REQ-02-27 | Form errors are shown inline, per field, immediately on submit | 02-REQUIREMENTS.md §6 | `source/assets/js/client/lagg-till.js` – all errors shown in one `#form-errors` box (not per-field) | — | gap |
| REQ-02-28 | Submit button is disabled while submission is in progress | 02-REQUIREMENTS.md §6 | `source/assets/js/client/lagg-till.js` – `submitBtn.disabled = true` | — | implemented |
| REQ-02-29 | A clear confirmation is shown after a successful submission | 02-REQUIREMENTS.md §6 | `source/assets/js/client/lagg-till.js` – reveals `#result` section | — | implemented |
| REQ-02-30 | Network failure shows a clear error message and allows the user to retry | 02-REQUIREMENTS.md §6 | `source/assets/js/client/lagg-till.js` – `.catch()` handler | — | implemented |
| REQ-02-31 | `title` is present and non-empty in form validation | 02-REQUIREMENTS.md §9 | `source/assets/js/client/lagg-till.js` | — | implemented |
| REQ-02-32 | `date` falls within the active camp's date range in form validation | 02-REQUIREMENTS.md §9 | `source/build/render-add.js` – `min`/`max` on input; not explicitly checked in `lagg-till.js` | — | implemented |
| REQ-02-33 | `start` is in valid `HH:MM` format in form validation | 02-REQUIREMENTS.md §9 | `source/build/render-add.js` – `type="time"` enforces format in browser | — | implemented |
| REQ-02-34 | `end`, if provided, is after `start` in form validation | 02-REQUIREMENTS.md §9 | `source/assets/js/client/lagg-till.js` – `end <= start` check | — | implemented |
| REQ-02-35 | `location` is present and non-empty in form validation | 02-REQUIREMENTS.md §9 | `source/assets/js/client/lagg-till.js` | — | implemented |
| REQ-02-36 | `responsible` is present and non-empty in form validation | 02-REQUIREMENTS.md §9 | `source/assets/js/client/lagg-till.js` | — | implemented |
| REQ-02-37 | All required API fields are present and of the correct type before any write | 02-REQUIREMENTS.md §10 | `source/api/validate.js` – `validateEventRequest()` | `tests/validate.test.js` – required fields suite | covered |
| REQ-02-38 | Only known fields are written to YAML; unknown POST body fields are ignored | 02-REQUIREMENTS.md §10 | `source/api/github.js` – `buildEventYaml()` extracts a fixed field set | `tests/github.test.js` – `buildEventYaml` suite | covered |
| REQ-02-39 | String values are type-checked (description, link, ownerName must be strings) | 02-REQUIREMENTS.md §10 | `source/api/validate.js` – optional field type checks | `tests/validate.test.js` – optional fields suite | covered |
| REQ-02-40 | String values are length-limited; extremely long strings are rejected | 02-REQUIREMENTS.md §10 | — | — | gap |
| REQ-02-41 | User-provided strings are never directly interpolated into YAML text | 02-REQUIREMENTS.md §10 | `source/api/github.js` – `yamlScalar()` handles all YAML quoting | `tests/github.test.js` – `yamlScalar` suite | covered |
| REQ-02-42 | Validation failure results in HTTP 400; nothing is committed to GitHub | 02-REQUIREMENTS.md §10 | `app.js` – returns `res.status(400)` before calling `addEventToActiveCamp` | — | implemented |
| REQ-02-43 | Activities are always displayed in chronological order (date, then start time) | 02-REQUIREMENTS.md §11 | `source/build/render.js` – `groupAndSortEvents()` | `tests/render.test.js` – `groupAndSortEvents` suite | covered |
| REQ-02-44 | Overlapping activities are allowed and the schedule remains readable | 02-REQUIREMENTS.md §11 | `source/build/render.js` – no exclusion logic; CSS layout | — | implemented |
| REQ-02-45 | A newly submitted activity appears in the schedule within a few minutes | 02-REQUIREMENTS.md §12 | `source/api/github.js` – ephemeral branch + PR auto-merge | — | implemented |
| REQ-02-46 | Admin edits to YAML are reflected in all schedule views | 02-REQUIREMENTS.md §12 | `source/build/build.js` – reads from YAML at build time | — | implemented |
| REQ-02-47 | Color contrast is at least 4.5:1 for body text | 02-REQUIREMENTS.md §13 | `source/assets/cs/style.css` – uses design tokens (`--color-charcoal` on `--color-cream`) | — | implemented |
| REQ-02-48 | All interactive elements have visible focus states | 02-REQUIREMENTS.md §13 | — (focus styles not confirmed in CSS) | — | gap |
| REQ-02-49 | Navigation is fully keyboard accessible | 02-REQUIREMENTS.md §13 | `source/build/layout.js` – uses `<a>` and `<nav>` elements (native keyboard support) | — | implemented |
| REQ-02-50 | Images have descriptive `alt` text | 02-REQUIREMENTS.md §13 | `source/build/render-index.js` – `extractHeroImage()` preserves alt; `inlineHtml()` for content images | `tests/render-index.test.js` – `converts an image to <img>` | covered |
| REQ-02-51 | The add-activity form is usable without a mouse | 02-REQUIREMENTS.md §13 | `source/build/render-add.js` – uses standard form controls (native keyboard support) | — | implemented |
| REQ-02-52 | Accordion and expandable elements use proper ARIA attributes (`aria-expanded`, `aria-controls`) | 02-REQUIREMENTS.md §13 | `source/build/render.js` – uses `<details>/<summary>` (native, no explicit ARIA added) | — | gap |
| REQ-02-53 | The site is written entirely in Swedish (content, labels, errors, confirmations, alt text) | 02-REQUIREMENTS.md §14 | All templates and client JS use Swedish text | — | implemented |
| REQ-02-54 | RSS feed reflects the current state of the schedule | 02-REQUIREMENTS.md §15 | — | — | gap |
| REQ-02-55 | Past camp data is never deleted; archived flag marks completed camps | 02-REQUIREMENTS.md §16 | `source/data/camps.yaml` – `archived` field; no deletion code | — | implemented |
| REQ-02-56 | Archive page lists all past camps and links to their schedules | 02-REQUIREMENTS.md §16 | — | — | gap |
| REQ-02-57 | When no camp is active, the most recent archived camp is shown by default | 02-REQUIREMENTS.md §16 | `source/build/build.js` – falls back to most recent camp (not filtered by `archived: true`) | — | implemented |
| REQ-02-58 | The site works well on mobile devices | 02-REQUIREMENTS.md §17 | `source/assets/cs/style.css` – responsive layout using container widths | — | implemented |
| REQ-05-01 | `camps.yaml` includes all required fields: `id`, `name`, `start_date`, `end_date`, `file`, `active`, `archived` | 05-DATA_CONTRACT.md §1 | `source/build/build.js` – reads and uses these fields; no schema validation | — | implemented |
| REQ-05-02 | Exactly one camp may have `active: true` at a time | 05-DATA_CONTRACT.md §1 | `source/api/github.js` – `addEventToActiveCamp()` rejects if `activeCamps.length !== 1` | — | implemented |
| REQ-05-03 | A camp with `active: true` must not also have `archived: true` | 05-DATA_CONTRACT.md §1 | — | — | gap |
| REQ-05-04 | Each event must have the required fields: `id`, `title`, `date`, `start`, `location`, `responsible` | 05-DATA_CONTRACT.md §3 | `source/api/validate.js` – validates `title`, `date`, `start`, `location`, `responsible` (not `id`) | `tests/validate.test.js` – required fields suite | covered |
| REQ-05-05 | Event `date` must fall within the camp's `start_date` and `end_date` (inclusive) | 05-DATA_CONTRACT.md §4 | — (API server does not validate date against camp range) | — | gap |
| REQ-05-06 | `start` must use 24-hour `HH:MM` format | 05-DATA_CONTRACT.md §4 | `source/api/validate.js` – only checks that `start` is non-empty, not format | — | gap |
| REQ-05-07 | `end`, when present, must be after `start` | 05-DATA_CONTRACT.md §4 | `source/api/validate.js` – `end <= start` check | `tests/validate.test.js` – time ordering suite | covered |
| REQ-05-08 | The combination of `(title + date + start)` must be unique within a camp file | 05-DATA_CONTRACT.md §5 | — | — | gap |
| REQ-05-09 | Event `id` must be unique within the camp file | 05-DATA_CONTRACT.md §6 | — | — | gap |
| REQ-05-10 | Event `id` must be stable and not change after creation | 05-DATA_CONTRACT.md §6 | `source/api/github.js` – `slugify()` + date/time produces deterministic ID on creation | — | implemented |
| REQ-07-01 | All CSS uses the custom properties defined in `07-DESIGN.md §7`; no hardcoded colors, spacing, or typography values | 07-DESIGN.md §7 | `source/assets/cs/style.css` – all values use `var(--…)` tokens | — | implemented |
| REQ-07-02 | Accordion items use proper ARIA attributes (`aria-expanded`, `aria-controls`) | 07-DESIGN.md §9 | `source/build/render.js` – uses `<details>/<summary>` without explicit ARIA attributes | — | gap |
| REQ-CL-01 | The build produces static HTML/CSS/JS as final output (no server required to view pages) | CLAUDE.md §1–2 | `source/build/build.js` – writes to `public/` | — | implemented |
| REQ-CL-02 | No client-side rendering framework is used | CLAUDE.md §1–2 | `source/assets/js/client/` – plain vanilla JS | — | implemented |
| REQ-CL-03 | JavaScript footprint is minimal | CLAUDE.md §1, §7 | Two small client-side scripts; no bundler or framework | — | implemented |
| REQ-CL-04 | Main page sections are authored in Markdown | CLAUDE.md §3 | `source/build/render-index.js` – `convertMarkdown()` | `tests/render-index.test.js` – full suite | covered |
| REQ-CL-05 | HTML validation runs in CI; build fails if HTML is invalid | CLAUDE.md §5 | — (no HTML linter configured in `package.json` or `ci.yml`) | — | gap |
| REQ-CL-06 | CSS linting runs in CI; build fails if CSS is invalid | CLAUDE.md §5 | — (no CSS linter configured; only ESLint for JS and markdownlint) | — | gap |
| REQ-CL-07 | JS linting runs in CI; build fails if lint fails | CLAUDE.md §5 | `.github/workflows/ci.yml` – `npm run lint` (ESLint) | — | implemented |
| REQ-CL-08 | Event data validated at build time for required fields, valid dates, and no duplicate identifiers | CLAUDE.md §5 | — (validation only occurs at the API layer for submitted events; no build-time YAML validation) | — | gap |
| REQ-CL-09 | Build runs locally and in GitHub Actions | CLAUDE.md §5–6 | `source/build/build.js`, `.github/workflows/ci.yml` | — | implemented |
| REQ-CL-10 | CI fails if the build fails | CLAUDE.md §5 | `.github/workflows/ci.yml` – `npm run build` step will exit non-zero on failure | — | implemented |
| REQ-CL-11 | Built output lives in `/public` | CLAUDE.md §9 | `source/build/build.js` – `OUTPUT_DIR = public/` | — | implemented |

---

## Summary

```
Total requirements:                    68
Covered (implemented + tested):        16
Implemented, not tested:               36
Gaps (no implementation or critical deficiency): 16
Orphan tests (no matching requirement): 0
```

---

## Top Gaps – Prioritised Action List

These are the requirements with status `gap`, ordered by severity and user impact.

### Critical – broken user-facing features

1. **REQ-02-03 – Daily view with day navigation** (`/dagens-schema.html`)
   The requirements define this page as a day-by-day schedule with navigation between days.
   The current implementation at this URL is the display-mode (dark, projector) view.
   There is no page that lets a user browse individual days.

2. **REQ-02-04 – URL/layout mismatch for Today/Display view** (`/idag.html`)
   The requirements assign the dark, no-nav display view to `/idag.html`.
   The implementation has the dark view at `/dagens-schema.html` and a standard-layout today view at `/idag.html`.
   The URL assignments are inverted relative to the spec.

3. **REQ-02-27 – Per-field inline form errors**
   `lagg-till.js` collects all errors into a single `#form-errors` block.
   The requirement is that each error is shown inline at the relevant field.

### High – missing whole features

4. **REQ-02-06 / REQ-02-56 – Archive page** (`/arkiv.html`)
   No archive page exists. Past camps cannot be browsed.

5. **REQ-02-07 / REQ-02-54 – RSS feed** (`/schema.rss`)
   No RSS feed is generated.

6. **REQ-02-40 – String length limits in API validation**
   `validate.js` checks types but has no maximum-length enforcement.
   Unbounded strings can be committed to YAML.

### Medium – data integrity gaps

7. **REQ-05-05 – Event date must fall within camp dates (API)**
   The API server accepts any valid `YYYY-MM-DD` date regardless of whether it falls within the active camp's `start_date`–`end_date`. Events can be written outside the camp period.

8. **REQ-05-06 – `start` must be `HH:MM` format (API)**
   `validate.js` only checks that `start` is non-empty. An invalid time string (e.g. `"25:99"` or `"morning"`) passes validation and would be written to the YAML file.

9. **REQ-05-08 – Duplicate event uniqueness not enforced**
   The `(title + date + start)` combination is not checked for uniqueness before committing. Identical events can be created.

10. **REQ-05-09 – Event ID uniqueness not enforced**
    The generated `id` is deterministic based on title/date/start, so identical submissions would produce the same ID. But this is never checked against the existing file.

11. **REQ-05-03 – `active: true` and `archived: true` are mutually exclusive**
    No code validates that a camp marked `active` is not also `archived`.

12. **REQ-CL-08 – Build-time YAML data validation**
    Required fields, date ranges, and duplicate IDs are only caught at the API layer.
    Manually edited YAML can be committed without any validation.

### Low – quality and tooling gaps

13. **REQ-CL-05 – HTML validation in CI**
    No HTML linter is configured. Invalid HTML would not fail the build.

14. **REQ-CL-06 – CSS linting in CI**
    No CSS linter is configured. Invalid or non-compliant CSS would not fail the build.

15. **REQ-02-48 / REQ-02-52 / REQ-07-02 – Accessibility gaps**
    Focus styles are not verified in CSS. The `<details>/<summary>` accordion does not have explicit `aria-expanded` or `aria-controls` attributes (though browsers add some ARIA natively for `<details>`).

16. **REQ-02-48 – Visible focus states not confirmed**
    The CSS was not audited for explicit `:focus-visible` rules on interactive elements.
